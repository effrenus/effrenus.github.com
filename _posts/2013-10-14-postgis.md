---
layout: layout
title: Если требуются координаты границ административных округов
category: blog
tags: ["postgis", "osm", "geo", "coordinates", "dump"]
---
Итак, понадобилось получить координаты всех административных единиц Московской области. задача не новая, значит кто-нибудь да решал её и скорее всего поделился своими находками. Спрашиваем гугл, в результатах обнаруживаем уже все готовое: http://www.gadm.org/country - радостно скачиваю .kmz, открываю в Google Earth. Сразу видно минусы: нет разбивки по регионам, устаревшие данные. М-да, перспектива редактировать границы, состоящих из множества точек, не радует.

Какие есть еще варианты?

### Яндекс карты
Предоставляют данные только по границам регионов, данные берут из OSM

### Wikimapia
Все устраивает, но я не нашел никакого дампа. А как эти данные выцепить через API не понял. Сервис предоставляет не более 100 запрос к апи в день. Из полезного: возможность найти организации рядом с домом, но есть небольшая проблема с их категоризацией=)

### OpenStreetMap
OpenStreetMap - карта, которая редактируется пользоватетями. У проекта есть свой формат XML, с подробной вики по полям.
Есть хорошее описание структуры osm файлов на хабре: 
Это много лучше. Последние обновления по России выкладываются на сайте osm-dump.ru, есть общий файл по России, а также разбивки по регионам. Но лучше скачать общий файл, так как в разбивках могут отсутствовать некоторые way, node.
Для работы с дампами есть отличные утилиты:
* osmconvert - преобразует формат файла, позволяет оставить определенную географическую область
* osmfilter - удаляет все, что не подпадает под фильтр

Требуется оставить только Подмосковье
{% highlight bat %}
	./osmconvert RU.osm.pbf -b=34.9704,54.2109,40.3537,57.0977 --drop-author --complete-ways --complex-ways --drop-version --out-o5m -o=RU_MO.o5m
{% endhighlight %}

Выбираем административные округа
{% highlight bat %}
	./osmfilter RU_MO.o5m --keep="admin_level=6" -o=RU_MO_bound.osm
{% endhighlight %}

Заполняем базу с необходимыми столбцами
{% highlight bat %}
	osm2pgsql RU_MO_bound.osm -d osm_db -U postgres -s -S ~/bound.style
{% endhighlight %}